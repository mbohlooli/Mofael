<input
  *ngIf="data.length != 0"
  type="text"
  class="form-control"
  style="margin-bottom: 15px;"
  placeholder="جستجو..."
  ngModel
  #query="ngModel"
  (input)="search(query.value)"
/>
<ng-container *ngIf="filteredData.length != 0; else noData">
  <table class="table table-bordered table-striped table-hover">
    <thead>
      <tr>
        <th></th>

        <th
          *ngFor="let column of columns"
          (click)="sort(column.path)"
          style="cursor: pointer;"
        >
          {{ column.label }}
          <i
            [style.color]="
              sortColumn.path == column.path ? 'black' : 'transparent'
            "
            class="fa {{
              sortColumn.order == 'asc' ? 'fa-sort-down' : 'fa-sort-up'
            }}"
          ></i>
        </th>

        <th *ngIf="actions.update || actions.delete || actions.info"></th>
      </tr>
    </thead>

    <tbody>
      <tr class="data-row" *ngFor="let item of pagedData; let i = index">
        <td style="width: 2%;">{{ (page - 1) * limit + i + 1 }}</td>

        <td *ngFor="let column of columns">
          <ng-container
            *ngIf="getType(pick(item, column.path)) != 'object'; else obj"
            >{{ pick(item, column.path) }}
          </ng-container>

          <ng-template #obj>
            <span
              *ngFor="let subItem of pick(item, column.path); let j = index"
              [class]="column.classes[subItem[column.subPath]]"
            >
              {{ pick(subItem, column.subPath) }}
            </span>
          </ng-template>
        </td>

        <td *ngIf="actions.update || actions.delete || actions.info">
          <!-- REVIEW: bootstrap toast shall be useful -->
          <button
            *ngIf="actions.info"
            class="btn btn-info btn-circle"
            style="margin-left: 10px;"
            (click)="router.navigate([infoUrl + item._id])"
          >
            <i class="fas fa-info"></i>
          </button>

          <button
            *ngIf="actions.update"
            class="btn btn-primary btn-circle"
            style="margin-left: 10px;"
            (click)="router.navigate([updateUrl + item._id])"
          >
            <i class="fas fa-pen"></i>
          </button>

          <button
            *ngIf="actions.delete"
            class="btn btn-danger btn-circle"
            data-toggle="modal"
            [attr.data-target]="deleteWithoutWarning ? '' : '#deleteModal'"
            (click)="
              deleteWithoutWarning
                ? deleteByIndex(i)
                : deleteIndex > 0
                ? delete()
                : (this.deleteIndex = i)
            "
          >
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="row">
    <div class="col-2">
      <div class="input-group input-group-sm mb-3" style="width: 150px;">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">تعداد</span>
        </div>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="limit"
          (input)="syncPages()"
          [min]="1"
          [max]="filteredData.length"
        />
      </div>
    </div>
    <div class="col-3">
      <div class="center">
        نمایش {{ limit }} مورد از {{ filteredData.length }}

        <button
          class="btn btn-sm btn-danger"
          style="margin-right: 20px;"
          data-toggle="modal"
          [attr.data-target]="'#deleteAllModal'"
        >
          &times; حذف همه
        </button>
      </div>
    </div>

    <div class="col-5"></div>

    <div class="col-2">
      <div class="float-left">
        <pagination
          [page]="page"
          [pagesCount]="pagesCount"
          [pageNumbers]="getPageNumbersArray()"
          [forwardDisabled]="page * limit >= filteredData.length"
          [backwardDisabled]="(page - 1) * limit == 0"
          (pageSelect)="syncPages(pagesCount - $event + 1)"
          (forward)="!(page * limit >= filteredData.length) ? shiftPage(1) : 0"
          (backward)="(page - 1) * limit != 0 ? shiftPage(-1) : 0"
        ></pagination>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #noData>
  <div class="card bg-info text-white shadow rtl" style="padding: 15px;">
    <div class="text-inline">
      <i class="fa fa-info-circle" style="margin-left: 10px;"></i> داده ای برای
      نمایش یافت نشد.
    </div>
  </div>
</ng-template>

<!-- delete modal -->
<div class="modal fade rtl" id="deleteModal" role="dialog">
  <confirmation-modal
    title="اخطار"
    actionName="حذف"
    color="danger"
    (close)="deleteIndex = -1"
    (action)="delete()"
  >
    <div class="body">
      آیا از حذف این مورد اطمینان دارید؟
    </div>
  </confirmation-modal>
</div>

<!-- delete All modal -->
<div class="modal fade rtl" id="deleteAllModal" role="dialog">
  <confirmation-modal
    title="اخطار"
    actionName="حذف"
    color="danger"
    (close)="deleteIndex = -1"
    (action)="deleteAll()"
  >
    <div class="body">
      آیا از حذف تمامی موراد اطمینان دارید؟
    </div>
  </confirmation-modal>
</div>
